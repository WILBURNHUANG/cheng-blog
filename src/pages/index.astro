---
import BaseLayout from "../layouts/BaseLayout.astro";
import PostCard from "../components/PostCard.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("posts", ({ data }) => !data.draft))
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
const [featured, ...rest] = posts;
const highlights = rest.slice(0, 3);

const sections = [
  {
    key: "AI",
    eyebrow: "Neural Horizons",
    title: "Artificial Intelligence",
    copy: "Applied research notes on agents, models, and the workflows they reshape.",
  },
  {
    key: "Space Tech",
    eyebrow: "Orbital Ops",
    title: "Space Technology",
    copy: "Flight software, cislunar logistics, and the hardware taking us further out.",
  },
  {
    key: "Outdoor Sports",
    eyebrow: "Wilderness Systems",
    title: "Outdoor Experiments",
    copy: "Tools for moving fast and safely when the trail ends and the ridge begins.",
  },
  {
    key: "Thoughts",
    eyebrow: "Operating Principles",
    title: "Field Notes",
    copy: "Perspectives on leadership, focus, and the rituals that keep teams curious.",
  },
  {
    key: "Startups",
    eyebrow: "Build Mode",
    title: "Startups",
    copy: "Playbooks and infrastructure for builders shipping at orbital velocity.",
  },
  {
    key: "Money",
    eyebrow: "Capital Currents",
    title: "Money",
    copy: "Investing in resilience, energy, and the rails powering a distributed future.",
  },
].map((section) => ({
  ...section,
  posts: posts.filter((post) => post.data.category === section.key).slice(0, 2),
}));
---
<BaseLayout>
  <section class="grid gap-8 lg:grid-cols-[1.8fr_1fr]">
    <div class="relative overflow-hidden rounded-[2.5rem] border border-white/10 bg-[radial-gradient(circle_at_top,_rgba(92,225,255,0.2),_transparent_55%),_linear-gradient(140deg,rgba(10,21,48,0.95),rgba(5,15,33,0.85))] p-10 shadow-[0_35px_90px_rgba(6,15,36,0.55)]">
      <div class="flex items-center gap-2 text-xs font-medium uppercase tracking-[0.32em] text-accent/90">
        <span class="h-2 w-2 rounded-full bg-accent"></span>
        Dispatch
      </div>
      <h1 class="mt-5 max-w-2xl text-4xl font-semibold text-white md:text-5xl">
        Exploring technology at altitude—from neural networks to mountain ridgelines.
      </h1>
      <p class="mt-4 max-w-xl text-base text-muted md:text-lg">
        Curated briefings on intelligent systems, space infrastructure, and the human skills required to pilot both.
      </p>
      <div class="mt-8 flex flex-wrap items-center gap-3">
        <a
          href={featured ? `/posts/${featured.slug}` : "/thoughts"}
          class="inline-flex items-center gap-2 rounded-full bg-accent px-6 py-2 text-sm font-semibold text-[#041222] shadow-[0_18px_45px_rgba(92,225,255,0.35)] transition hover:translate-y-[1px]"
        >
          Read featured story
          <svg viewBox="0 0 20 20" fill="none" class="h-4 w-4">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 10h10" />
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m11 6 4 4-4 4" />
          </svg>
        </a>
        <a href="/search" class="inline-flex items-center gap-2 text-sm text-muted transition hover:text-white">
          Browse the archive
          <svg viewBox="0 0 20 20" fill="none" class="h-4 w-4">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m8 5 4 5-4 5" />
          </svg>
        </a>
      </div>
      {featured?.data.hero && (
        <img
          src={featured.data.hero}
          alt={featured.data.title}
          loading="lazy"
          class="pointer-events-none absolute -right-16 bottom-[-3rem] hidden w-[360px] translate-y-6 rounded-[3rem] border border-white/10 shadow-[0_35px_90px_rgba(3,12,32,0.55)] lg:block"
        />
      )}
    </div>

    <div class="flex flex-col gap-5">
      <div class="rounded-3xl border border-white/10 bg-[rgba(9,18,40,0.78)] p-6 shadow-[0_24px_60px_rgba(5,12,28,0.45)]">
        <div class="flex items-center justify-between">
          <h2 class="text-sm font-semibold tracking-wide text-white/90">Signal Boost</h2>
          <a href="/thoughts" class="text-xs text-muted transition hover:text-white">See all</a>
        </div>
        <div class="mt-5 space-y-5">
          {(highlights.length ? highlights : posts.slice(0, 3)).map((post) => (
            <a href={`/posts/${post.slug}`} class="group flex items-start gap-4 rounded-2xl p-3 transition hover:bg-white/5">
              {post.data.hero ? (
                <img src={post.data.hero} alt="" class="h-14 w-14 flex-none rounded-xl object-cover" loading="lazy" />
              ) : (
                <div class="h-14 w-14 flex-none rounded-xl bg-surfaceMuted/60"></div>
              )}
              <div class="flex-1">
                <p class="text-[11px] uppercase tracking-[0.28em] text-muted">{post.data.category}</p>
                <p class="mt-1 text-sm font-medium text-white transition group-hover:text-accent">{post.data.title}</p>
                <p class="mt-1 text-xs text-muted">
                  {post.data.date.toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" })}
                </p>
              </div>
            </a>
          ))}
        </div>
      </div>

      <div class="rounded-3xl border border-white/10 bg-[rgba(9,18,40,0.78)] p-6 shadow-[0_24px_60px_rgba(5,12,28,0.45)]">
        <h2 class="text-sm font-semibold text-white/90">Stay in the loop</h2>
        <p class="mt-2 text-sm text-muted">Monthly dispatches from the mountains to the launchpad. No noise.</p>
        <a
          href="mailto:cheng@example.com"
          class="mt-4 inline-flex w-full items-center justify-center gap-2 rounded-full bg-white/10 px-4 py-2 text-sm font-medium text-white transition hover:bg-white/20"
        >
          Join the newsletter
          <svg viewBox="0 0 20 20" fill="none" class="h-4 w-4">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m5 7 5 4 5-4" />
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.5 6.75 10 10.5l5.5-3.75" />
          </svg>
        </a>
      </div>
    </div>
  </section>

  <section class="space-y-12">
    {sections.map((section) => (
      <div class="space-y-6">
        <div class="flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between">
          <div>
            <p class="text-[11px] uppercase tracking-[0.35em] text-muted">{section.eyebrow}</p>
            <h2 class="text-3xl font-semibold text-white">{section.title}</h2>
            <p class="mt-2 max-w-2xl text-sm text-muted">{section.copy}</p>
          </div>
          <a href={`/${section.key.toLowerCase().replace(/\s+/g, "-")}`} class="text-sm text-muted transition hover:text-white">
            View all {section.title.toLowerCase()} →
          </a>
        </div>
        <div class="grid gap-6 md:grid-cols-2">
          {section.posts.map((post) => <PostCard post={post} />)}
        </div>
      </div>
    ))}
  </section>
</BaseLayout>
