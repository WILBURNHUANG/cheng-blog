---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("posts", ({ data }) => !data.draft);
const tagCounts = new Map<string, number>();

for (const post of posts) {
  for (const tag of post.data.tags ?? []) {
    tagCounts.set(tag, (tagCounts.get(tag) ?? 0) + 1);
  }
}

const tags = Array.from(tagCounts.entries()).sort((a, b) => {
  if (b[1] === a[1]) {
    return a[0].localeCompare(b[0], "en");
  }
  return b[1] - a[1];
});
---
<BaseLayout title="Tags â€” Tech & Trek" description="Browse every topic tag covered on Tech & Trek.">
  <section class="mx-auto flex w-full max-w-4xl flex-col gap-6">
    <header class="rounded-3xl border border-white/5 bg-[#0a1625]/70 p-8 shadow-[0_20px_65px_rgba(4,16,32,0.30)]">
      <p class="text-xs uppercase tracking-[0.35em] text-accent">Explore</p>
      <h1 class="mt-4 text-3xl font-semibold text-white sm:text-4xl">Browse by Tag</h1>
      <p class="mt-2 text-sm text-muted">
        Dive straight into the topics that matter most to you across space tech, AI, outdoor adventures, and more.
      </p>
    </header>

    {tags.length === 0 ? (
      <p class="rounded-3xl border border-white/5 bg-[#060f1f]/80 p-8 text-muted">
        No tags to display yet. Publish your first post to populate this page.
      </p>
    ) : (
      <ul class="flex flex-wrap gap-3 rounded-3xl border border-white/5 bg-[#060f1f]/80 p-8">
        {tags.map(([tag, count]) => (
          <li>
            <a
              href={`/tags/${encodeURIComponent(tag)}`}
              class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/[0.04] px-4 py-2 text-sm text-muted transition hover:border-accent/60 hover:text-accent"
            >
              <span>#{tag}</span>
              <span class="rounded-full bg-white/5 px-2 py-1 text-xs text-white/60">{count}</span>
            </a>
          </li>
        ))}
      </ul>
    )}
  </section>
</BaseLayout>
